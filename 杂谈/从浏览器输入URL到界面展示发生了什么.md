[TOC]

### 输入网址

当你在浏览器输入网址时，浏览器会根据书签或者历史记录推荐相关网址

### 浏览器查找域名的IP地址

1. 请求发起后，游览器首先会解析这个域名，首先它会查看**本地硬盘的 hosts 文件**，看看其中有没有和这个域名对应的规则，如果有的话就直接使用 hosts 文件里面的 ip 地址
2. 如果在本地的 hosts 文件没有能够找到对应的 ip 地址，浏览器会发出一个 DNS请求到**本地DNS(域名分布系统)服务器** 。本地DNS服务器一般都是你的网络接入服务器商提供，比如中国电信，中国移动。本地DNS服务器会首先查询它的缓存记录，如果缓存中有此条记录，就可以直接返回结果，此过程是递归的方式进行查询。
3. 本地DNS服务器如果没有，还要向**DNS根服务器**进行查询，根DNS服务器没有记录具体的域名和IP地址的对应关系，而是告诉本地DNS服务器，你可以到域服务器上去继续查询，并给出域服务器的地址。这种过程是迭代的过程
4. 本地DNS服务器继续向**域服务器**发出请求，在这个例子中，请求的对象是.com域服务器。.com域服务器收到请求之后，也不会直接返回域名和IP地址的对应关系，而是告诉本地DNS服务器，你的域名的解析服务器的地址
5. 最后，本地DNS服务器向域名的解析服务器发出请求，这时就能收到一个域名和IP地址对应关系，本地DNS服务器不仅要把IP地址返回给用户电脑，还要把这个对应关系**保存在缓存**中，以备下次别的用户查询时，可以直接返回结果，加快网络访问。

### 建立TCP链接

在拿到域名对应的IP地址后，会以随机端口（1024~~65535）向WEB服务器程序80端口发起TCP的连接请求，这个连接请求进入到内核的TCP/IP协议栈（用于识别该连接请求，解封包，一层一层的剥开），还有可能要经过Netfilter防火墙（属于内核的模块）的过滤，最终到达WEB程序，最终建立了TCP/IP的连接，对于客户端与服务器的TCP链接，必然要说的就是『三次握手』。

![image-20210317112450635](https://gitee.com/trastor/picture/raw/master/20210317112451.png)

1. 客户端发送一个带 SYN=1，Seq=X 的数据包到服务器端口（第一次握手，由浏览器发起，告诉服务器我要发送请求了）
2. 服务器发回一个带 SYN=1， ACK=X+1， Seq=Y 的响应包以示传达确认信息（第二次握手，由服务器发起，告诉浏览器我准备接受了，你赶紧发送吧）
3. 客户端再回传一个带 ACK=Y+1， Seq=Z 的数据包，代表“握手结束”（第三次握手，由浏览器发送，告诉服务器，我马上就发了，准备接受吧）

**说明：**

- ACK：确认标识，用于表示对数据包的成功接收。

- SYN：同步标识，表示TCP连接已初始化。

**三次握手的目的：为了防止已经失效的连接请求报文段突然又传送到了服务器端，从而产生错误。**

### 浏览器向服务器发送HTTP请求

请求报文由请求行、请求头和请求体三部分组成。

1. 请求行包含请求方法、url和协议版本。
2. 请求头包含请求的附加信息，由键值对组成。如Host:github.com、User-Agent：""、Connection:keep-alive以及Cookie。
3. 请求体主要是请求参数（Query String Parameters）。

### 服务端处理并返回结果

服务器端收到请求后的由web服务器（准确说应该是http服务器）处理请求，诸如Apache、Ngnix、IIS等。web服务器解析用户请求，知道了需要调度哪些资源文件，再通过相应的这些资源文件处理用户请求和参数，并调用数据库信息，最后将结果通过web服务器返回给浏览器客户端。

### 关闭TCP链接

为了避免服务器与客户端双方的资源占用和损耗，当双方没有请求或响应传递时，任意一方都可以发起关闭请求。与创建TCP连接的3次握手类似，关闭TCP连接，需要4次握手。

下图可以通俗化：

客户端：老弟，我这边没数据要传了，咱们关闭链接吧

服务端：好的，接收到了，我看看我这边还有没有要传的

服务端：我这边也没有了，关闭吧

客户端：好嘞

![image-20210317113036126](https://gitee.com/trastor/picture/raw/master/20210317113036.png)

### 浏览器解析资源并渲染

1. HTML解析，处理HTML标记并构建DOM树。

2. CSS解析，处理CSS标记并构建CSSOM树。

3. 将DOM树和CSSOM合并称render tree(渲染树)。将每条css规则按照【从右至左】的方式在dom树上进行逆向匹配，然后生成具有样式规则描述的渲染树。

4. 渲染树布局，计算每个节点的集合信息。包括repaint和reflow。

5. 渲染树绘制，将每个节点绘制到屏幕上。

   ![image-20210317113400684](https://gitee.com/trastor/picture/raw/master/20210317113400.png)